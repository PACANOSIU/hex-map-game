<!DOCTYPE html>
<html>
<head>
<script src="js/ocanvas-2.7.1-beta.min.js"></script>
<script src="js/misc.js"></script>
<style>canvas {
    display: block;
    border:1px solid #222
}</style>
</head>
<body>
<canvas id="HexCanvas" width="1000" height="700"></canvas>
<script>
var canvas = oCanvas.create({
	canvas: "#HexCanvas"
});
var width = canvas.width;
var height = canvas.height;
function drawHex(x0, y0, fillColor, debugText, col, row) {
	//Using ocanvas
	//Add text and ellipses first, so that the Hex layer is on top (for clicking)
	hex[row][col] = canvas.display.polygon({
		x: x0,
		y: y0,
		sides: 6,
		radius: this.radius,
		rotation: 0,
		fill: fillColor,
		stroke: "outside 1px #000",
		row: row,
		col: col,
		zIndex: "back",
		selected: false
	});
	hex[row][col].add(false);	
	hex[row][col].bind("click tap", function () {
			//Highlighting selected Hex
			var hex = canvas.display.polygon({
				x: x0,
				y: y0,
				sides: 6,
				radius: radius,
				rotation: 0,
				stroke: "outside 4px #00F2FF"
			});
			hex.bind("click tap", function () {
				canvas.removeChild(hex);
				canvas.removeChild(rectangle);
				canvas.removeChild(text);
			});
			hex.add();
			//Attack button
			var rectangle = canvas.display.rectangle({
				x: width-100,
				y: 25,
				origin: { x: "center", y: "center" },
				width: 60,
				height: 35,
				fill: "#0aa",
				stroke: "10px #0aa",
				join: "round"
			});
			rectangle.bind("click tap", function () {
				console.log("Clicked Attack");
			});
			canvas.addChild(rectangle);
			//Text for Attack Button
			var text = canvas.display.text({
				x: width-100,
				y: 25,
				origin: { x: "center", y: "center" },
				align: "center",
				font: "bold 14px sans-serif",
				weight: "bold",
				text: "Attack",
				fill: "#000",
				pointerEvents: false
			});
			text.add();
		console.log("Hex Positon: " + this.row + " " + this.col);
		console.log(hex[row][col]);
		canvas.redraw();
	});
	var randomColor = get_random_color();
	var text = canvas.display.text({
		x: x0,
		y: y0,
		origin: { x: "center", y: "center" },
		align: "center",
		font: "bold 14px sans-serif",
		weight: "bold",
		text: Math.floor((Math.random() * 9) + 1),
		fill: randomColor,
		pointerEvents: false
	});
	text.add(false);
	var ellipse = canvas.display.ellipse({
		x: x0,
		y: y0,
		radius: 10,
		stroke: "1px "+ randomColor,
		pointerEvents: false
	});
	ellipse.add(false);
};

function drawHexGrid (rows, cols, originX, originY, isDebug) {
	originX = 25;
    originY = 25;
    var currentHexX;
    var currentHexY;
    var debugText = "";
    var offsetColumn = false;

    for (var col = 0; col < cols; col++) {
        for (var row = 0; row < rows; row++) {
            if (!offsetColumn) {
                currentHexX = (col * this.side) + originX;
                currentHexY = (row * this.height) + originY;
            } else {
                currentHexX = col * this.side + originX;
                currentHexY = (row * this.height) + originY + (this.height * 0.5);
            }
            if (isDebug) {
                debugText = col + "," + row;
            }
            drawHex(currentHexX, currentHexY, "#ddd", debugText, col, row);
        }
        offsetColumn = !offsetColumn;
    }
	canvas.redraw();
};
var radius = 20;
var side = (3 / 2) * radius;
var height = Math.sqrt(3) * radius;

var iMax = 30;
var jMax = 30;
var hex = new Array();
for (i=0;i<iMax;i++) {
 hex[i]=new Array();
 for (j=0;j<jMax;j++) {
  hex[i][j]=0;
 }
}
var canvasOriginX = 25;
var canvasOriginY = 25;
drawHexGrid(15, 25, 25, 25, true);

</script>
</body>
</html>